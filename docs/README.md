# Web Interface for Real-Time Bitcoin Buy Zone Check

This web interface provides a browser-based tool to check Bitcoin's buy zone status in real-time.

## Features

- **Real-time Price**: Fetches current BTC price from Yahoo Finance
- **Buy Zone Analysis**: Calculates whether Bitcoin is in the "double undervaluation" buy zone
- **Dual Timezone**: Shows time in both UTC and Berlin (CET/CEST)
- **Distance Calculation**: Shows exactly how much BTC needs to drop to enter buy zone
- **Pure JavaScript**: No backend required, runs entirely in browser
- **Data Reuse**: Uses the same CSV and JSON data generated by the Python script

## How It Works

### Data Flow

```
Python (daily via GitHub Actions)
  ↓
Generate btc_metrics.csv & btc_metadata.json
  ↓
Commit to GitHub
  ↓
GitHub Pages serves static files
  ↓
User opens webpage
  ↓
JavaScript loads CSV/JSON data
  ↓
User clicks "Check Now" button
  ↓
Fetch real-time price from Yahoo Finance
  ↓
Calculate DCA & Trend in browser
  ↓
Display results
```

## Local Testing

### Option 1: Using Python HTTP Server

```bash
# From the project root
cd docs
python -m http.server 8000

# Open browser to:
# http://localhost:8000
```

### Option 2: Using Node.js HTTP Server

```bash
# Install http-server globally
npm install -g http-server

# From the project root
cd docs
http-server -p 8000

# Open browser to:
# http://localhost:8000
```

### Option 3: Direct File Opening

Simply open `docs/index.html` in your browser. Note: Some features may not work due to CORS restrictions when opening local files.

## Yahoo Finance CORS Issue

### Problem

Yahoo Finance API may block direct browser requests due to CORS (Cross-Origin Resource Sharing) restrictions.

### Solution Options

1. **Enable CORS Proxy** (in `realtime.js`):
   ```javascript
   const CONFIG = {
       USE_CORS_PROXY: true,  // Change to true
       CORS_PROXY: 'https://corsproxy.io/?',
       // ...
   };
   ```

2. **Use Alternative Proxy**:
   - https://corsproxy.io/
   - https://cors-anywhere.herokuapp.com/ (may require activation)

3. **Deploy to GitHub Pages** (usually works better than localhost)

## Deploying to GitHub Pages

### Step 1: Enable GitHub Pages

1. Go to your repository on GitHub
2. Click **Settings**
3. Scroll to **Pages** section
4. Under **Source**, select:
   - Branch: `main`
   - Folder: `/docs`
5. Click **Save**

### Step 2: Wait for Deployment

GitHub will build and deploy your site. It will be available at:
```
https://<username>.github.io/<repository-name>/
```

### Step 3: Test the Live Site

Visit your GitHub Pages URL and click the "Check Real-Time Buy Zone Status" button.

## Automatic Daily Updates

The GitHub Actions workflow (`.github/workflows/update-data.yml`) automatically:

- Runs daily at 00:30 UTC
- Executes `python main.py`
- Updates `btc_metrics.csv` and `btc_metadata.json`
- Commits changes back to the repository
- GitHub Pages automatically redeploys

This ensures:
- Historical data is always up-to-date
- Charts reflect the latest close prices
- DCA and Trend parameters are recalculated daily

## File Structure

```
docs/
  ├── index.html        # Main webpage
  ├── realtime.js       # JavaScript logic (pure JS, no dependencies)
  └── README.md         # This file

data/                   # Data shared with Python
  ├── btc_metrics.csv   # Historical prices and metrics
  └── btc_metadata.json # Trend parameters (a, b)

charts/                 # Python-generated interactive charts
  ├── valuation_ratios.html
  ├── price_comparison.html
  └── double_uv_stats.html
```

## How the JavaScript Calculations Work

### 1. DCA Cost Calculation

```javascript
// Harmonic mean of last 200 days
function calculateDCA(prices) {
    const last200 = prices.slice(-200);
    const sumInverse = last200.reduce((sum, p) => sum + 1/p, 0);
    return 200 / sumInverse;
}
```

### 2. Trend Calculation

```javascript
// Power law model: trend = a * t^n
// where t = Bitcoin age (days since genesis 2009-01-03)
function calculateTrend(a, n, bitcoinAgeDays) {
    return a * Math.pow(bitcoinAgeDays, n);
}
```

### 3. Distance to Buy Zone

```javascript
// Percentage drop needed to reach ratio < 1.0
function calculateDistance(ratio) {
    if (ratio >= 1.0) {
        return ((ratio - 1.0) / ratio) * 100;
    } else {
        return ((1.0 - ratio) / 1.0) * 100;  // Already below
    }
}
```

## Troubleshooting

### "Failed to load historical data"

- Ensure `data/btc_metrics.csv` exists
- Run `python main.py` to generate data
- Check file paths in `CONFIG` object

### "CORS error - Yahoo Finance blocked"

- Enable CORS proxy in `realtime.js`:
  ```javascript
  USE_CORS_PROXY: true
  ```
- Or deploy to GitHub Pages (CORS often works better from deployed sites)

### "Trend parameters not found"

- Ensure `data/btc_metadata.json` exists
- Run `python main.py` to generate metadata
- Check that `trend_a` and `trend_b` exist in JSON

### Charts not loading

- Ensure charts are in the correct path: `../charts/`
- Run `python main.py` to generate charts
- Charts link opens in a new tab

## Performance

- **First Load**: ~1-2 seconds (loading CSV data)
- **Button Click**: ~1-2 seconds (Yahoo Finance API call)
- **No Backend**: All calculations run in your browser
- **Data Size**: ~200KB CSV + ~1KB JSON (fast to load)

## Browser Compatibility

Works in all modern browsers:
- Chrome/Edge 90+
- Firefox 88+
- Safari 14+
- Opera 76+

Requires:
- ES6 support (arrow functions, async/await)
- Fetch API
- Intl.DateTimeFormat for timezone display

## Security

- No API keys required
- No sensitive data stored
- All calculations run client-side
- No cookies or tracking

## License

Same as the main project (see root LICENSE file)

